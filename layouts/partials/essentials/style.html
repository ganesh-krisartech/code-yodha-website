<!-- DNS preconnect -->
<meta http-equiv="x-dns-prefetch-control" content="on" />
<link rel="preconnect" href="https://use.fontawesome.com" crossorigin />
<link rel="preconnect" href="//cdnjs.cloudflare.com" />
<link rel="preconnect" href="//www.googletagmanager.com" />
<link rel="preconnect" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="https://use.fontawesome.com" />
<link rel="dns-prefetch" href="//ajax.googleapis.com" />
<link rel="dns-prefetch" href="//cdnjs.cloudflare.com" />
<link rel="dns-prefetch" href="//www.googletagmanager.com" />
<link rel="dns-prefetch" href="//www.google-analytics.com" />
<link rel="dns-prefetch" href="//fonts.googleapis.com" />
<link rel="dns-prefetch" href="//connect.facebook.net" />
<link rel="dns-prefetch" href="//platform.linkedin.com" />
<link rel="dns-prefetch" href="//platform.twitter.com" />

<!-- google fonts -->
{{ $pf := site.Data.theme.fonts.font_family.primary }}
{{ $sf := site.Data.theme.fonts.font_family.secondary }}
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<script>
  (function () {
    const googleFont = document.createElement("link");
    googleFont.href = "https://fonts.googleapis.com/css2?family={{$pf | safeURL}}{{with $sf}}&family={{. | safeURL}}{{end}}&display=swap";
    googleFont.type = "text/css";
    googleFont.rel = "stylesheet";
    document.head.appendChild(googleFont);
  })();
</script>

<!-- main styles -->
{{ $styles := slice }}
{{ $stylesLazy := slice }}

{{ range site.Params.plugins.css }}
{{ if findRE "^http" .link }}
<link
        crossorigin="anonymous"
        media="all"
        rel="stylesheet"
        href="{{ .link | relURL }}"
        {{ .attributes | safeHTMLAttr }} />
{{ else }}
{{ if not .lazy }}
{{ $resource := resources.Get .link }}
{{ if $resource }}
{{ $styles = $styles | append $resource }}
{{ end }}
{{ else }}
{{ $resource := resources.Get .link }}
{{ if $resource }}
{{ $stylesLazy = $stylesLazy | append $resource }}
{{ end }}
{{ end }}
{{ end }}
{{ end }}

{{ $builtCSS := resources.Get "css/built.css" }}
{{ if $builtCSS }}
{{ $styles = $styles | append $builtCSS }}
{{ $styles = $styles | resources.Concat "css/style.css" }}
{{ if hugo.IsProduction }}
{{ $styles = $styles | minify | fingerprint }}
{{ end }}
<!-- link main style -->
<link href="{{ $styles.RelPermalink }}" rel="stylesheet" {{ with $styles.Data.Integrity }}integrity="{{ . }}"{{ end }} />
{{ else }}
<!-- Fallback: try loading built.css directly if Concat fails -->
<link rel="stylesheet" href="{{ "css/built.css" | relURL }}" />
{{ end }}

{{ if gt (len $stylesLazy) 0 }}
{{ $stylesLazy = $stylesLazy | resources.Concat "css/style-lazy.css" }}
{{ if hugo.IsProduction }}
{{ $stylesLazy = $stylesLazy | minify | fingerprint }}
{{ end }}
<!-- link lazy style -->
<link
        defer
        async
        rel="stylesheet"
        href="{{ $stylesLazy.RelPermalink }}"
        integrity="{{ $stylesLazy.Data.Integrity }}"
        media="print"
        onload="this.media='all'; this.onload=null;" />
{{ end }}
